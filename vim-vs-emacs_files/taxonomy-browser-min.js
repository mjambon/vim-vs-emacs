/*! Copyright (c) 2013 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.1.3
 *
 * Requires: 1.2.2+
 */
(function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)})(function(f){function c(q){var j,k=q||window.event,v=[].slice.call(arguments,1),m=0,p=0,o=0,e=0,n=0;return q=f.event.fix(k),q.type="mousewheel",k.wheelDelta&&(m=k.wheelDelta),k.detail&&(m=-1*k.detail),k.deltaY&&(o=-1*k.deltaY,m=o),k.deltaX&&(p=k.deltaX,m=-1*p),void 0!==k.wheelDeltaY&&(o=k.wheelDeltaY),void 0!==k.wheelDeltaX&&(p=-1*k.wheelDeltaX),e=Math.abs(m),(!g||g>e)&&(g=e),n=Math.max(Math.abs(o),Math.abs(p)),(!h||h>n)&&(h=n),j=m>0?"floor":"ceil",m=Math[j](m/g),p=Math[j](p/h),o=Math[j](o/h),v.unshift(q,m,p,o),(f.event.dispatch||f.event.handle).apply(this,v)}var g,h,a=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],b="onwheel" in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];if(f.event.fixHooks){for(var d=a.length;d;){f.event.fixHooks[a[--d]]=f.event.mouseHooks}}f.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var i=b.length;i;){this.addEventListener(b[--i],c,!1)}}else{this.onmousewheel=c}},teardown:function(){if(this.removeEventListener){for(var i=b.length;i;){this.removeEventListener(b[--i],c,!1)}}else{this.onmousewheel=null}}},f.fn.extend({mousewheel:function(i){return i?this.bind("mousewheel",i):this.trigger("mousewheel")},unmousewheel:function(i){return this.unbind("mousewheel",i)}})});(function TaxonomyBrowser(){var y=200;var c="/taxonomy/json/";var b="/browse/";var t={};var C=[];var E={};var A=null;var e=null;var g=null;var F=null;function m(K){a(K);if((typeof(t[K])!="undefined")){return t[K]}else{return[]}}function D(L,M){if(M>0){if(typeof(_gaq)!=="undefined"){_gaq.push(["_trackEvent","Taxonomy Browser","Subject Clicked",L,true])}}if(M<=(C.length-1)){n(M)}else{}if(typeof(t[L])=="undefined"){}var K=m(L);C.push(L);s(L,K)}function s(M,K){i();p(M,K);var L=$(".levels-position").position().left;var O=$(".levels-position .level").length;var P=Math.abs(L/F);var N=O-(3)-P;if((N>0)){G("-="+(F*N))}}function p(M,L){function O(Q){var P=$.map(Q,function(R){return{name:R,hasChild:(t[R].length>0),link:l(R),count:E[R]}});return P}if(M==="/"){var N=E.ROOT}else{var N=E[M]}var K=x({items:O(L),level:C.length,view_all_link:l(M),view_all_total:N});$(".levels-position").append(K);r($(".level").last())}function i(){function L(M){var N=$.map(M,function(P,O){return{label:P,level:O}});N.shift();return N}var K=f({items:L(C)});$(".breadcrumb").replaceWith(K)}function h(M){var N=$(M.target);if(N.hasClass("no-children")){return true}M.preventDefault();var K=N.data("level");D(j(N),K);var L=N.closest(".level");L.find("a").removeClass("active");N.addClass("active")}function z(M){var N=$(M.target);M.preventDefault();var K=N.data("level");var L=(K>=2)?((K-2)*-F):0;G(L);n(K+1);i();r($(".level").last())}function q(L){L.preventDefault();var M=$(L.target);if(!M.hasClass("active")){return false}var K=(M.hasClass("next"))?"-=":"+=";var N=K+$(".level").outerWidth(true);G(N)}function k(O){O.preventDefault();var N=$(O.target);var M=N.siblings(".level-scroll");var L=M.children("ul").height();var Q=M.scrollTop();var K=800;var P=N.hasClass("up")?Q:L-Q;K=Math.round(P*K/L);M.animate({scrollTop:N.hasClass("up")?0:L},K)}function B(M){M.preventDefault();var L=$(M.target);var K=L.siblings(".level-scroll");K.stop()}function d(O,Q,M,K){O.preventDefault();var N=Math[(K<0?"floor":"ceil")](K/60);var L=N*10;var P=$(this).scrollTop();$(this).scrollTop(P-L)}function G(K){$(".levels-position").stop().animate({left:K},y,J)}function J(){var L=$(".levels-position").position().left;var N=$(".levels-position .level").length;var P=Math.abs(L/F);var M=N-3-P;var O=A.find(".prev");var K=A.find(".next");if(P>0){O.show().addClass("active")}else{O.hide().removeClass("active")}if(M>0){K.show().addClass("active")}else{K.hide().removeClass("active")}}function w(L,K){clearTimeout(g);L.removeClass("level-active-over");if((L.data("level")<=C.length)||(K&&(K.data("level")<L.data("level")))){L.removeClass("level-active");L.addClass("level-selection")}e=null;var M=$(".level").last();if(!K&&(L!==M)){r(M)}}function r(K){clearTimeout(g);if(e!==null&&(e.data("level")!==K.data("level"))){w(e,K)}K.removeClass("level-selection");K.addClass("level-active level-active-over");e=K}function I(){var K=['<div id="taxonomy-browser" class="areas">','<div class="wrapper">','<p class="breadcrumb"></p>','<div class="levels">','<div class="levels-container cf">','<div class="levels-position"></div>',"</div>",'<a href="#" class="prev"></a>','<a href="#" class="next active"></a>',"</div>","</div>","</div>"];$("#pagehdr-wrap").after(K.join("\n"))
}function x(M){var L=$.map(M.items,function(O,N){return["<li>",'<a href="'+O.link+'"'+(O.hasChild?"":' class="no-children"')+' data-level="'+M.level+'">',O.name+(O.hasChild?"":" ("+O.count+")"),"</a>","</li>"].join("\n")});var K=['<div class="level" data-level="'+M.level+'">','<div class="level-scroll">',"<ul>",'<li><a href="'+M.view_all_link+'" class="no-children">View All Articles ('+M.view_all_total+")</a></li>",L.join("\n"),"</ul>","</div>"];if(M.items.length>4){K.push(['<a href="#" class="up"></a>','<a href="#" class="down"></a>'])}K.push(["</div>"]);return K.join("\n")}function f(M){var K=$.map(M.items,function(O,N){return['<span class="level'+O.level+'">','<a href="'+l(O.label)+'" data-level="'+O.level+'">'+O.label+"</a>",(((N+1)<M.items.length)?" / ":""),"</span>"].join("\n")});var L=['<p class="breadcrumb">',"<strong>Browse Subject Areas:</strong>",K.join("\n"),"</p>"].join("\n");return L}function H(L){var K=$.extend([],C);if((typeof(L)!=="undefined")&&(L!=="/")){K.push(L)}K.shift();return c+encodeURIComponent(K.join("/"))+"&journal="+$("meta[name=currentJournal]").attr("content")+"&showCounts=true"}function l(L){var K=b;if((typeof(L)!=="undefined")&&(L!=="/")){K=K+encodeURIComponent(L.replace(new RegExp("\\s","g"),"_").toLowerCase())}return K}function j(K){return $.trim(K.html())}function a(M){function K(O,Q,P){var N=$.map(O.categories,function(S,R){if(S.length>0){t[R]=S}else{t[R]=[]}return R});$.each(O.counts,function(S,R){E[S]=R});t[M]=N.sort()}function L(N,P,O){console.log("JSON load unsuccessful");$("#mn-01 a").unbind("click",u);$("#mn-01 a").attr("title","Error: No subject terms available!");$("#mn-01 a").addClass("disabled");$("#mn-01 a").on("click",function(Q){Q.preventDefault();return false})}$.ajax({url:H(M),type:"GET",dataType:"json",async:false}).then(K,L);return true}function n(K){while($(".levels .level").length>K){$(".levels .level").last().remove();C.pop()}}function o(L){if($tb.queue().length>0){return}L=L||false;var K=$tb.is(":hidden");if(L||!K){if(!K){$tb.slideUp();$("#searchStripForm").slideDown()}}else{$tb.slideDown();$("#searchStripForm").slideUp()}}function u(K){if(typeof(_gaq)!=="undefined"){_gaq.push(["_trackEvent","Taxonomy Browser","Browser Opened","",true])}K.preventDefault();K.stopPropagation();o()}function v(){$(".level-active").hover(function(){$(this).addClass("level-active-over")},function(){$(this).removeClass("level-active-over")});$("#mn-01 a").on("click",u);$(document).bind("click",function(L){o(true);if(typeof(_gaq)!=="undefined"){_gaq.push(["_trackEvent","Taxonomy Browser","Browser Closed","",true])}});$tb.click(function(L){L.stopPropagation()});var K=$(".levels-position");if(!(("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch)){K.on("mouseenter",".level",function(L){r($(L.currentTarget))});K.on("mouseleave",".level",function(L){g=setTimeout(function(){w($(L.currentTarget))},500)});K.on("mousedown",".level > a",k);K.on("mouseup",".level > a",B)}K.on("mousewheel",".level-scroll",d);K.on("click",".level > a",function(L){L.preventDefault()});K.on("click","ul li a",h);$(".wrapper").on("click",".breadcrumb a",z);A.on("click",".prev",q);A.on("click",".next",q)}$(document).ready(function(){I();A=$(".levels");$tb=$("#taxonomy-browser");v();D("/",0);F=$(".levels-position .level").outerWidth(true)})})();