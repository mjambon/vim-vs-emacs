$.fn.twitter=function(){this.displayTwitterCites=function(a){var b=new $.fn.alm();b.getCitesTwitterOnly(a,jQuery.proxy(this.setTweets,this),jQuery.proxy(this.setError,this))};this.setError=function(b,a){$("#twitterError").text("Our system is having a bad day. We are working on it. Please check back later.");$("#twitterError").show("blind",1000)};this.setTweets=function(a,c,b){window.tweetsResponse=a;$(".spinner").fadeOut(1000);$("#tweets").css("display","none");this.showTweetsPage(0);$("#tweets").show("blind",1000)};this.showTweetsPage=function(e){var n=window.tweetsResponse;var b=0;var r=n[0].sources[0];var j=50;$("#tweets").empty();if(r&&r.metrics.total>0){var o=r.events;o=o.sort(jQuery.proxy(this.sort_tweets_by_date,this));b=o.length;var f=Math.ceil(b/j);var k=e*j;var d=Math.min(b,k+j);var h=$("<ol></ol>");for(var c=k;c<d;c++){var g=o[c].event;var m=o[c].event_url;var q=isNaN(Date.parse(g.created_at))?$.datepicker.formatDate("M d, yy",this.parseTwitterDate(g.created_at)):$.datepicker.formatDate("M d, yy",new Date(g.created_at));h.append('<li><div><img src="'+g.user_profile_image+'"/><span class="text"><a href="https://twitter.com/#!/'+g.user+'">'+g.user+"</a> "+this.linkify(g.text)+"</span><br/><a target='_blank' href=\""+m+'"><span class="text">'+q+"</span></a></div></li>")}h.attr("start",e*j+1);h.css("counter-reset","item "+(e*j));var l=this.paging(f,e);$("#tweets").append(l.clone(),h,l)}var a="";if(b<1){a="No tweets found"}else{var p="";if(b>1){p="s"}a=b+" tweet"+p+" as recorded by Twitter.  Article published "+$.datepicker.formatDate("M d, yy",new Date(n[0].publication_date))+". Tweets updated "+$.datepicker.formatDate("M d, yy",new Date(r.update_date))+"."}$("#tweets").prepend(a)};this.parseTwitterDate=function(a){var b=a.replace(/(\d{1,2}[:]\d{2}[:]\d{2}) (.*)/,"$2 $1");b=b.replace(/(\+\S+) (.*)/,"$2 $1");return new Date(Date.parse(b))};this.sort_tweets_by_date=function(e,c){var f=isNaN(e.event.created_at)?this.parseTwitterDate(e.event.created_at):e.event.created_at;var d=isNaN(c.event.created_at)?this.parseTwitterDate(c.event.created_at):c.event.created_at;return(new Date(d).getTime())-(new Date(f).getTime())};this.linkify=function(b){b=b+" ";var d=/((ht|f)tp(s?):\/\/[a-zA-Z0-9\-\.\/]+?)([\s])/g;var c=b.replace(d,function(g,f,i,j,h){return'<a href="'+f+'">'+f+"</a> "});var e=/#([A-Za-z0-9/-]+?)([:\s])/g;c=c.replace(e,function(h,f,g,j,i){return'<a href="https://twitter.com/#!/search/%23'+f+'">#'+f+"</a>"+g});var a=/@([A-Za-z0-9_]+)([:\s])/g;c=c.replace(a,function(g,j,f,i,h){return'<a href="https://twitter.com/'+j+'">@'+j+"</a>"+f});return c};this.paging=function(g,e){var b=$("<div></div>");if(g>1){b.attr("class","pagination");var c="<span>...</span>";var f='<span class="prev">&lt;</span>';var d='<span class="next">&gt;</span>';if(g<4){if(e>0){b.append(this.pagingAnchor((e-1),"&lt;","prev"))}else{b.append(f)}for(var a=0;a<g;++a){if(a==e){b.append("<strong>"+(e+1)+"</strong>")}else{b.append(this.pagingAnchor(a,a+1))}}if(e<(g-1)){b.append(this.pagingAnchor(e+1,"&gt;","next"))}else{b.append(d)}}else{if(e>0){b.append(this.pagingAnchor((e-1),"&lt;","prev"));b.append(this.pagingAnchor(0,1))}else{b.append(f+"<strong>1</strong>")}if(e>2){b.append(c)}for(var a=Math.min(e,0);a<=Math.max(3,e+2);++a){if((a>1&&a<g&&a>(e-1)||((a==(g-2))&&(a>(e-2))))){if((e+1)==a){b.append("<strong>"+a+"</strong>")}else{b.append(this.pagingAnchor(a-1,a))}}}if(e<(g-3)){b.append(c)}if(e<(g-1)){b.append(this.pagingAnchor(g-1,g));b.append(this.pagingAnchor(e+1,"&gt;","next"))}else{b.append("<strong>"+g+"</strong>"+d)}}}return b};this.pagingAnchor=function(a,d,c){var b=$("<a></a>").attr({href:"#",title:"("+(a+1)+")",onclick:"twitter.showTweetsPage("+a+"); return false;"}).html(d);if(c){b.attr("class",c)}return b};this.displayTweetsArticleSidebar=function(a){var b=new $.fn.alm();b.getCitesTwitterOnly(a,jQuery.proxy(this.showTweetsArticleSidebar,this),jQuery.proxy(this.setError,this))};this.showTweetsArticleSidebar=function(r){var t,c,g,f,h,l,q,d,e,m,k,o,n,a,u,j,b,p;f=2;h=5;t=r[0].sources[0];if(t&&t.metrics.total>0){c=t.events;c=c.sort(jQuery.proxy(this.sort_tweets_by_date,this));g=(c.length>h)?h:c.length;l=$("<ol></ol>");for(q=0;q<g;q++){d=c[q].event;e=isNaN(Date.parse(d.created_at))?$.datepicker.formatDate("M d, yy",this.parseTwitterDate(d.created_at)):$.datepicker.formatDate("M d, yy",new Date(d.created_at));if(q<f){m=$("<li></li>").addClass("tweet-entry display")}else{m=$("<li></li>").addClass("tweet-entry hide")}m.hover(function(){$(this).find("ul.tweet-actions").css("visibility","visible")},function(){$(this).find("ul.tweet-actions").css("visibility","hidden")});b=this.getTweetTimeDisplay(d.created_at);p='<a href="https://twitter.com/'+d.user+"/statuses/"+d.id+'">'+b+"</a>";o=$("<div></div>").addClass("tweet-user").append($("<div></div>").addClass("twitter-posttime").html(p)).append($("<a></a>").attr("href","https://twitter.com/"+d.user).append($("<img>").attr("src",d.user_profile_image)).append($("<div></div>").append($("<span></span>").addClass("twitter-fullname").html(d.user_name)).append($("<span></span>").addClass("twitter-username").html("@"+d.user))));
m.append(o);k=$("<div></div>").addClass("tweet-text").html(this.linkify(d.text));m.append(k);a=$("<a></a>").attr("href","https://twitter.com/intent/favorite?in_reply_to="+d.id).addClass("tweet-reply-action").attr("title","Reply").html("<span></span>Reply");u=$("<a></a>").attr("href","https://twitter.com/intent/retweet?tweet_id="+d.id).addClass("tweet-retweet-action").attr("title","Retweet").html("<span></span>Retweet");j=$("<a></a>").attr("href","https://twitter.com/intent/favorite?tweet_id="+d.id).addClass("tweet-favorite-action").attr("title","Favorite").html("<span></span>Favorite");n=$("<ul></ul>").addClass("tweet-actions").append($("<li></li>").append(a)).append($("<li></li>").append(u)).append($("<li></li>").append(j));o=$("<div></div>").append(n);m.append(o);l.append(m)}$("#twitter-alm-timeline").append(l);var s=encodeURI($("meta[name=citation_doi]").attr("content"));if(c.length>f){$("#twitter-alm-timeline").append($("<button></button>").html("Load More").click(function(){$("#twitter-alm-timeline li.tweet-entry.hide").removeClass("hide").addClass("display");var i=$("<a></a>").attr("href","/article/twitter/info:doi/"+s).html("View all tweets");$(this).html("").append(i);$(this).css("background-image","none")}))}else{$("#twitter-alm-timeline").append($("<button></button>").append($("<a></a>").attr("href","/article/twitter/info:doi/"+s).html("View all tweets")).css("background-image","none"))}$("#twitter-alm-timeline").prepend($("<div></div>").addClass("tweet-header").append($("<img>").addClass("tweet-header-logo").attr("src","/images/tweet_bird_blue_32.png")).append($("<b></b>").html("Archived Tweets")))}};this.getTweetTimeDisplay=function(d){var a=isNaN(Date.parse(d))?this.parseTwitterDate(d):new Date(d);var c=new Date().getTime();var f=Math.round((c-a)/1000/60/60);var b="";var e=365*24;if(f>e){b=$.datepicker.formatDate("d M y",a)}else{if(f>=24){b=$.datepicker.formatDate("d M",a)}else{if(f>=1){b=Math.round(f)+"h"}else{f=(c-a)/1000/60;if(f>=1){b=Math.round(f)+"m"}else{f=(c-a)/1000;b=Math.round(f)+"s"}}}}return b}};